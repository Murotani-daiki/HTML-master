<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="æ—¥æœ¬ã®åœ°åå½“ã¦ã‚²ãƒ¼ãƒ ã€åœ°åã§Wordleã€ã€‚æ¯æ—¥5å›ã®æ©Ÿä¼šã§æ—¥æœ¬ã®éƒ½å¸‚ã‚„åœ°åŸŸã‚’å½“ã¦ã‚‹ã‚²ãƒ¼ãƒ ã€‚æ¥½ã—ãªãŒã‚‰åœ°ç†ã‚’å­¦ã¹ã¾ã™ã€‚">
    <meta name="keywords" content="Wordle,åœ°å,æ—¥æœ¬,ã‚²ãƒ¼ãƒ ,åœ°ç†å­¦ç¿’,æ¯æ—¥ãƒãƒ£ãƒ¬ãƒ³ã‚¸,åœ°åŸŸ">
    <meta name="author" content="html-master">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>æ—¥æœ¬ã®åœ°åã§Wordle - æ¯æ—¥ã®åœ°åå½“ã¦ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚²ãƒ¼ãƒ </title>
    
    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="æ—¥æœ¬ã®åœ°åã§Wordle">
    <meta property="og:description" content="æ—¥æœ¬ã®åœ°åå½“ã¦ã‚²ãƒ¼ãƒ ã€åœ°åã§Wordleã€ã€‚æ¯æ—¥5å›ã®æ©Ÿä¼šã§æ—¥æœ¬ã®éƒ½å¸‚ã‚„åœ°åŸŸã‚’å½“ã¦ã‚‹ã‚²ãƒ¼ãƒ ã€‚æ¥½ã—ãªãŒã‚‰åœ°ç†ã‚’å­¦ã¹ã¾ã™ã€‚">
    <meta property="og:url" content="https://html-master.com/chimei-de-wordle/">
    <meta property="og:site_name" content="æ—¥æœ¬ã®åœ°åã§Wordle">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="æ—¥æœ¬ã®åœ°åã§Wordle">
    <meta name="twitter:description" content="æ—¥æœ¬ã®åœ°åå½“ã¦ã‚²ãƒ¼ãƒ ã€åœ°åã§Wordleã€ã€‚æ¯æ—¥5å›ã®æ©Ÿä¼šã§æ—¥æœ¬ã®éƒ½å¸‚ã‚„åœ°åŸŸã‚’å½“ã¦ã‚‹ã‚²ãƒ¼ãƒ ã€‚">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://html-master.com/chimei-de-wordle/">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75' fill='%23ff69b4'>â›©</text></svg>">
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QW2BGSDCLF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QW2BGSDCLF');
</script>
    
    <style>
        :root {
            --correct: #6aaa64;
            --present: #c9b458;
            --absent: #787c7e;
            --tile-border: #d3d6da;
            --tile-border-filled: #878a8c;
            --key-bg: #d3d6da;
            --bg: #ffffff;
            --text: #1a1a2e;
            --tile-text: #ffffff;
            --header-bg: #1a1a2e;
            --modal-bg: rgba(0,0,0,0.6);
            --sakura: #f8b4c8;
            --sakura-dark: #e8849a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* Sakura petals animation */
        .sakura-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .sakura-petal {
            position: absolute;
            top: -20px;
            width: 12px;
            height: 12px;
            background: var(--sakura);
            border-radius: 50% 0 50% 50%;
            opacity: 0.6;
            animation: fall linear infinite;
        }

        @keyframes fall {
            0% { transform: translateY(-20px) rotate(0deg) translateX(0px); opacity: 0.7; }
            50% { opacity: 0.4; }
            100% { transform: translateY(100vh) rotate(720deg) translateX(80px); opacity: 0; }
        }

        /* Header */
        header {
            background: var(--header-bg);
            color: #fff;
            padding: 12px 20px;
            text-align: center;
            position: relative;
            z-index: 10;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        header h1 {
            font-size: 1.6rem;
            font-weight: 900;
            letter-spacing: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        header h1 .torii {
            font-size: 1.4rem;
        }

        header .subtitle {
            font-size: 0.75rem;
            color: #aaa;
            margin-top: 2px;
            letter-spacing: 1px;
        }

        .header-buttons {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 10px;
        }

        .header-btn {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .header-btn:hover {
            opacity: 1;
        }

        /* Main game area: fit between header and bottom of viewport */
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 10px 0;
            position: relative;
            z-index: 5;
            height: calc(100vh - 76px);
            box-sizing: border-box;
            overflow: hidden;
        }

        /* Board */
        .game-content {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            box-sizing: border-box;
            width: 100%;
            max-width: 520px;
        }

        #board {
            display: grid;
            grid-template-rows: repeat(6, 1fr);
            gap: 4px;
            padding: 4px 0;
            width: 100%;
            flex: 1 1 auto;
            max-height: calc(100% - 140px);
            box-sizing: border-box;
            align-self: center;
        }

        .row {
            display: grid;
            /* Use auto columns so column width matches tile width */
            grid-template-columns: repeat(5, auto);
            justify-content: center;
            gap: 4px;
        }

        .tile {
            /* Fixed tile size to avoid wide empty columns */
            width: 48px;
            aspect-ratio: 1;
            border: 2px solid var(--tile-border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--text);
            transition: transform 0.1s;
            user-select: none;
            border-radius: 4px;
            background: #fff;
        }

        .tile.filled {
            border-color: var(--tile-border-filled);
            animation: popIn 0.1s ease;
        }

        .tile.reveal {
            animation: flipIn 0.5s ease forwards;
        }

        .tile.correct {
            background: var(--correct);
            border-color: var(--correct);
            color: var(--tile-text);
        }

        .tile.present {
            background: var(--present);
            border-color: var(--present);
            color: var(--tile-text);
        }

        .tile.absent {
            background: var(--absent);
            border-color: var(--absent);
            color: var(--tile-text);
        }

        @keyframes popIn {
            0% { transform: scale(1); }
            50% { transform: scale(1.12); }
            100% { transform: scale(1); }
        }

        @keyframes flipIn {
            0% { transform: rotateX(0deg); }
            45% { transform: rotateX(90deg); }
            55% { transform: rotateX(90deg); }
            100% { transform: rotateX(0deg); }
        }

        @keyframes bounce {
            0%, 20% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            50% { transform: translateY(5px); }
            60% { transform: translateY(-10px); }
            80% { transform: translateY(2px); }
            100% { transform: translateY(0); }
        }

        .tile.win {
            animation: bounce 1s ease forwards;
        }

        .tile.shake {
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); }
            20%, 40%, 60%, 80% { transform: translateX(4px); }
        }

        /* Keyboard */
        #keyboard {
            max-width: 520px;
            width: 100%;
            padding: 6px 6px 10px;
            box-sizing: border-box;
            flex: 0 0 120px;
            max-height: 120px;
        }

        .kb-row {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-bottom: 6px;
        }

        .key {
            height: 44px;
            min-width: 28px;
            padding: 0 6px;
            border: none;
            border-radius: 6px;
            background: var(--key-bg);
            color: var(--text);
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            text-transform: uppercase;
            transition: all 0.2s;
            flex: 1;
            max-width: 56px;
            user-select: none;
            font-family: 'Noto Sans JP', sans-serif;
        }

        .key:active {
            transform: scale(0.98);
        }

        .key.wide {
            max-width: 96px;
            font-size: 0.8rem;
            padding: 0 10px;
        }

        .key.correct {
            background: var(--correct);
            color: var(--tile-text);
        }

        .key.present {
            background: var(--present);
            color: var(--tile-text);
        }

        .key.absent {
            background: var(--absent);
            color: var(--tile-text);
        }

        /* Toast notification */
        #toast-container {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .toast {
            background: var(--text);
            color: #fff;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 700;
            animation: fadeInOut 1.5s ease forwards;
            white-space: nowrap;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-10px); }
            15% { opacity: 1; transform: translateY(0); }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--modal-bg);
            z-index: 100;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal {
            background: #fff;
            border-radius: 16px;
            padding: 28px 24px;
            max-width: 440px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideUp 0.3s ease;
            position: relative;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-close {
            position: absolute;
            top: 12px;
            right: 16px;
            background: none;
            border: none;
            font-size: 1.4rem;
            cursor: pointer;
            color: #999;
            transition: color 0.2s;
        }

        .modal-close:hover {
            color: var(--text);
        }

        .modal h2 {
            text-align: center;
            margin-bottom: 16px;
            font-size: 1.3rem;
        }

        .modal p {
            text-align: center;
            margin-bottom: 10px;
            line-height: 1.6;
        }

        /* Result modal */
        .result-icon {
            text-align: center;
            font-size: 3rem;
            margin-bottom: 12px;
        }

        .result-answer {
            text-align: center;
            font-size: 1.6rem;
            font-weight: 900;
            color: var(--correct);
            margin-bottom: 4px;
            letter-spacing: 4px;
        }

        .result-kanji {
            text-align: center;
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 16px;
        }

        .result-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 900;
        }

        .stat-label {
            font-size: 0.7rem;
            color: #888;
        }

        /* Map container */
        #map-container {
            width: 100%;
            height: 250px;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 16px;
            border: 2px solid #eee;
            position: relative;
        }

        #map-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .map-label {
            text-align: center;
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 12px;
        }

        .map-label i {
            color: #ea4335;
            margin-right: 4px;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 28px;
            border: none;
            border-radius: 50px;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Noto Sans JP', sans-serif;
        }

        .btn-primary {
            background: var(--correct);
            color: #fff;
        }

        .btn-primary:hover {
            background: #5a9a54;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(106,170,100,0.4);
        }

        .btn-secondary {
            background: var(--header-bg);
            color: #fff;
        }

        .btn-secondary:hover {
            background: #2a2a4e;
            transform: translateY(-2px);
        }

        .btn-share {
            background: var(--correct);
            color: #fff;
        }

        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* How to play modal */
        .how-example {
            display: flex;
            gap: 4px;
            justify-content: center;
            margin: 12px 0;
        }

        .how-tile {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            font-weight: 700;
            border: 2px solid var(--tile-border);
            border-radius: 4px;
            color: var(--tile-text);
        }

        .how-text {
            font-size: 0.85rem;
            text-align: left;
            margin: 6px 0 14px;
            color: #555;
            line-height: 1.5;
        }

        .modal h3 {
            color: var(--header-bg);
            border-left: 4px solid var(--correct);
            padding-left: 10px;
        }

        hr {
            border: none;
            border-top: 1px solid #eee;
            margin: 12px 0;
        }

        /* Confetti */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 99;
            overflow: hidden;
        }

        .confetti {
            position: absolute;
            top: -10px;
            width: 10px;
            height: 10px;
            animation: confettiFall 3s ease-in forwards;
        }

        @keyframes confettiFall {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        /* Responsive */
        @media (max-width: 400px) {
            .tile {
                font-size: 1.4rem;
                max-width: 54px;
                max-height: 54px;
            }
            .key {
                height: 46px;
                font-size: 0.8rem;
            }
            header h1 {
                font-size: 1.3rem;
            }
        }

        /* Game count badge */
        .game-info {
            display: flex;
            justify-content: center;
            gap: 16px;
            padding: 6px 0;
            font-size: 0.75rem;
            color: #999;
        }

        .game-info span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Game with Banners Layout */
        .game-with-banners {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 12px;
            padding: 20px;
            position: relative;
            flex-wrap: wrap;
            width: 100%;
            box-sizing: border-box;
        }

        .game-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            flex: 0 1 auto;
            max-width: 600px;
        }

        /* Banner Aside */
        .banner-aside {
            flex: 0 0 auto;
            display: none;
            min-width: 160px;
        }

        .banner-wrapper {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 8px;
        }

        .banner-wrapper a {
            display: block;
            text-decoration: none;
        }

        .banner-wrapper img {
            display: block;
            max-width: 100%;
            height: auto;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Desktop: Show banners */
        @media (min-width: 1200px) {
            main {
                align-items: stretch;
            }

            .game-with-banners {
                flex-wrap: nowrap;
                justify-content: center;
                align-items: flex-start;
            }

            .banner-aside {
                display: block;
            }

            .banner-left,
            .banner-right {
                width: 160px;
                height: fit-content;
                flex-shrink: 0;
                flex: 0 0 160px;
            }

            .banner-left .banner-wrapper {
                gap: 6px;
                padding: 6px;
            }

            .banner-left a {
                display: block;
                overflow: hidden;
            }

            .banner-left img {
                width: 100%;
                height: auto;
                max-width: 160px;
            }

            .banner-right .banner-wrapper {
                width: 160px;
                overflow: hidden;
                flex: 0 0 160px;
            }

            .banner-right #rakuten-widget {
                width: 160px;
                overflow: hidden;
            }

            /* Rakuten iframe overflow fix */
            .banner-right #rakuten-widget iframe {
                max-width: 160px !important;
                width: 160px !important;
            }

            .banner-left {
                order: 1;
                margin-right: auto;
            }
            }

            .game-content {
                order: 2;
                flex-shrink: 0;
                flex: 0 1 auto;
            }

            .banner-right {
                order: 3;
                margin-left: auto;
            }
        }

        /* Tablet/Mobile: Hide banners or adjust */
        @media (max-width: 1199px) {
            .game-with-banners {
                flex-direction: column;
            }

            .banner-aside {
                display: none;
            }

            .game-content {
                width: 100%;
            }
        }

        /* Lost styling */
        .result-answer.lost {
            color: #e74c3c;
        }

        /* Ranking Modal Styles */
        .ranking-tabs {
            display: flex;
            justify-content: center;
            gap: 0;
            margin-bottom: 16px;
            border-bottom: 2px solid #eee;
        }

        .ranking-tab {
            background: none;
            border: none;
            padding: 10px 20px;
            font-size: 0.85rem;
            font-weight: 700;
            color: #999;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
            font-family: 'Noto Sans JP', sans-serif;
        }

        .ranking-tab:hover {
            color: #666;
        }

        .ranking-tab.active {
            color: var(--correct);
            border-bottom-color: var(--correct);
        }

        .ranking-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: 10px 12px;
            border-radius: 10px;
            margin-bottom: 6px;
            background: #f8f9fa;
            transition: background 0.2s;
            gap: 12px;
        }

        .ranking-item:hover {
            background: #f0f1f3;
        }

        .ranking-item.me {
            background: #e8f5e9;
            border: 2px solid var(--correct);
        }

        .ranking-item.top1 {
            background: linear-gradient(135deg, #fff9e6, #fff3cc);
            border: 2px solid #ffd700;
        }

        .ranking-item.top2 {
            background: linear-gradient(135deg, #f5f5f5, #e8e8e8);
            border: 2px solid #c0c0c0;
        }

        .ranking-item.top3 {
            background: linear-gradient(135deg, #fef0e8, #fde0cc);
            border: 2px solid #cd7f32;
        }

        .ranking-rank {
            font-size: 1.1rem;
            font-weight: 900;
            min-width: 32px;
            text-align: center;
            color: #666;
        }

        .ranking-rank.gold { color: #ffd700; }
        .ranking-rank.silver { color: #c0c0c0; }
        .ranking-rank.bronze { color: #cd7f32; }

        .ranking-name {
            flex: 1;
            font-weight: 700;
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .ranking-score {
            text-align: right;
            min-width: 60px;
        }

        .ranking-score .score-main {
            font-size: 1.1rem;
            font-weight: 900;
            color: var(--correct);
        }

        .ranking-score .score-label {
            font-size: 0.65rem;
            color: #999;
        }

        .ranking-detail {
            font-size: 0.7rem;
            color: #888;
            min-width: 70px;
            text-align: right;
        }

        .ranking-empty {
            text-align: center;
            padding: 40px 20px;
            color: #999;
            font-size: 0.9rem;
        }

        .ranking-empty i {
            font-size: 2rem;
            display: block;
            margin-bottom: 12px;
            color: #ddd;
        }

        /* Nickname input */
        .nickname-input-group {
            display: flex;
            gap: 8px;
            margin: 16px 0;
            justify-content: center;
        }

        .nickname-input-group input {
            padding: 10px 14px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 0.9rem;
            font-family: 'Noto Sans JP', sans-serif;
            width: 180px;
            outline: none;
            transition: border-color 0.2s;
        }

        .nickname-input-group input:focus {
            border-color: var(--correct);
        }

        .nickname-input-group button {
            padding: 10px 18px;
            background: var(--correct);
            color: #fff;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 0.85rem;
            transition: background 0.2s;
        }

        .nickname-input-group button:hover {
            background: #5a9a54;
        }

        .nickname-display {
            text-align: center;
            margin: 12px 0;
            font-size: 0.85rem;
            color: #666;
        }

        .nickname-display strong {
            color: var(--text);
        }

        .nickname-display .change-name {
            color: var(--correct);
            cursor: pointer;
            margin-left: 8px;
            font-size: 0.8rem;
            text-decoration: underline;
        }

        .ranking-loading {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .ranking-loading i {
            font-size: 1.5rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .my-ranking-bar {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .my-ranking-bar .ranking-rank {
            font-size: 1.3rem;
        }

        .my-ranking-bar .ranking-name {
            font-size: 0.95rem;
        }

        .my-ranking-bar .score-main {
            font-size: 1.3rem;
        }
    </style>
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "æ—¥æœ¬ã®åœ°åã§Wordle",
        "description": "æ—¥æœ¬ã®åœ°åå½“ã¦ã‚²ãƒ¼ãƒ ã€åœ°åã§Wordleã€ã€‚æ¯æ—¥5å›ã®æ©Ÿä¼šã§æ—¥æœ¬ã®éƒ½å¸‚ã‚„åœ°åŸŸã‚’å½“ã¦ã‚‹ã‚²ãƒ¼ãƒ ã€‚æ¥½ã—ãªãŒã‚‰åœ°ç†ã‚’å­¦ã¹ã¾ã™ã€‚",
        "url": "https://html-master.com/chimei-de-wordle/",
        "applicationCategory": "Game",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "JPY"
        },
        "author": {
            "@type": "Organization",
            "name": "html-master"
        }
    }
    </script>
</head>
<body>

<!-- Sakura petals -->
<div class="sakura-container" id="sakura"></div>

<!-- Header -->
<header>
    <h1>
        <span class="torii">â›©ï¸</span>
        æ—¥æœ¬ã®åœ°åã§Wordle
    </h1>
    <div class="subtitle">Japanese Place Name Wordle</div>
    <div class="header-buttons">
        <button class="header-btn" id="rankingBtn" title="ãƒ©ãƒ³ã‚­ãƒ³ã‚°"><i class="fas fa-trophy"></i></button>
        <button class="header-btn" id="helpBtn" title="éŠã³æ–¹"><i class="fas fa-question-circle"></i></button>
        <button class="header-btn" id="statsBtn" title="çµ±è¨ˆ"><i class="fas fa-chart-bar"></i></button>
    </div>
</header>

<!-- Main -->
<main>
    <div class="game-info">
        <span><i class="fas fa-map-marker-alt"></i> æ—¥æœ¬ã®åœ°å (5æ–‡å­—)</span>
        <span id="game-number"></span>
    </div>

    <div class="game-with-banners">
        <!-- Left Banner -->
        <aside class="banner-aside banner-left">
            <div class="banner-wrapper">
                <a href="https://hb.afl.rakuten.co.jp/hsc/50d61940.084dfcc5.50d5f9c2.39a6d3ac/?link_type=pict&ut=eyJwYWdlIjoic2hvcCIsInR5cGUiOiJwaWN0IiwiY29sIjoxLCJjYXQiOiI1OCIsImJhbiI6MzIzMDk1MiwiYW1wIjpmYWxzZX0%3D" target="_blank" rel="nofollow sponsored noopener">
                    <img src="https://hbb.afl.rakuten.co.jp/hsb/50d61940.084dfcc5.50d5f9c2.39a6d3ac/?me_id=1&me_adv_id=3230952&t=pict" alt="æ¥½å¤©ãƒãƒŠãƒ¼1" title="">
                </a>
                <a href="https://hb.afl.rakuten.co.jp/hsc/50d6155e.4f47c313.50d5f9c2.39a6d3ac/?link_type=pict&ut=eyJwYWdlIjoic2hvcCIsInR5cGUiOiJwaWN0IiwiY29sIjoxLCJjYXQiOiI0NCIsImJhbiI6Mjc5NDg4OSwiYW1wIjpmYWxzZX0%3D" target="_blank" rel="nofollow sponsored noopener">
                    <img src="https://hbb.afl.rakuten.co.jp/hsb/50d6155e.4f47c313.50d5f9c2.39a6d3ac/?me_id=1&me_adv_id=2794889&t=pict" alt="æ¥½å¤©ãƒãƒŠãƒ¼2" title="">
                </a>
                <a href="https://hb.afl.rakuten.co.jp/hsc/50d8691e.071ac45f.50d5f9c2.39a6d3ac/?link_type=pict&ut=eyJwYWdlIjoic2hvcCIsInR5cGUiOiJwaWN0IiwiY29sIjoxLCJjYXQiOiI4NSIsImJhbiI6MTE2MzIwMCwiYW1wIjpmYWxzZX0%3D" target="_blank" rel="nofollow sponsored noopener">
                    <img src="https://hbb.afl.rakuten.co.jp/hsb/50d8691e.071ac45f.50d5f9c2.39a6d3ac/?me_id=1&me_adv_id=1163200&t=pict" alt="æ¥½å¤©ãƒãƒŠãƒ¼3" title="">
                </a>
            </div>
        </aside>

        <!-- Game Content -->
        <div class="game-content">
            <div id="board"></div>
            <div id="keyboard"></div>
        </div>

        <!-- Right Banner -->
        <aside class="banner-aside banner-right">
            <div class="banner-wrapper">
                <a href="https://hb.afl.rakuten.co.jp/hsc/50d61940.084dfcc5.50d5f9c2.39a6d3ac/?link_type=pict&ut=eyJwYWdlIjoic2hvcCIsInR5cGUiOiJwaWN0IiwiY29sIjoxLCJjYXQiOiI1OCIsImJhbiI6MzIzMDk1MiwiYW1wIjpmYWxzZX0%3D" target="_blank" rel="nofollow sponsored noopener">
                    <img src="https://hbb.afl.rakuten.co.jp/hsb/50d61940.084dfcc5.50d5f9c2.39a6d3ac/?me_id=1&me_adv_id=3230952&t=pict" alt="æ¥½å¤©ãƒãƒŠãƒ¼1" title="">
                </a>
                <a href="https://hb.afl.rakuten.co.jp/hsc/50d6155e.4f47c313.50d5f9c2.39a6d3ac/?link_type=pict&ut=eyJwYWdlIjoic2hvcCIsInR5cGUiOiJwaWN0IiwiY29sIjoxLCJjYXQiOiI0NCIsImJhbiI6Mjc5NDg4OSwiYW1wIjpmYWxzZX0%3D" target="_blank" rel="nofollow sponsored noopener">
                    <img src="https://hbb.afl.rakuten.co.jp/hsb/50d6155e.4f47c313.50d5f9c2.39a6d3ac/?me_id=1&me_adv_id=2794889&t=pict" alt="æ¥½å¤©ãƒãƒŠãƒ¼2" title="">
                </a>
                <a href="https://hb.afl.rakuten.co.jp/hsc/50d8691e.071ac45f.50d5f9c2.39a6d3ac/?link_type=pict&ut=eyJwYWdlIjoic2hvcCIsInR5cGUiOiJwaWN0IiwiY29sIjoxLCJjYXQiOiI4NSIsImJhbiI6MTE2MzIwMCwiYW1wIjpmYWxzZX0%3D" target="_blank" rel="nofollow sponsored noopener">
                    <img src="https://hbb.afl.rakuten.co.jp/hsb/50d8691e.071ac45f.50d5f9c2.39a6d3ac/?me_id=1&me_adv_id=1163200&t=pict" alt="æ¥½å¤©ãƒãƒŠãƒ¼3" title="">
                </a>
            </div>
        </aside>
    </div>
</main>

<!-- Toast container -->
<div id="toast-container"></div>

<!-- Result Modal -->
<div class="modal-overlay" id="resultModal">
    <div class="modal">
        <button class="modal-close" id="resultClose">&times;</button>
        <div class="result-icon" id="resultIcon"></div>
        <h2 id="resultTitle"></h2>
        <div class="result-answer" id="resultAnswer"></div>
        <div class="result-kanji" id="resultKanji"></div>
        <div id="map-container"></div>
        <div class="map-label"><i class="fas fa-map-marker-alt"></i> <span id="mapLabelText"></span></div>
        <div class="result-stats">
            <div class="stat">
                <div class="stat-value" id="statPlayed">0</div>
                <div class="stat-label">ãƒ—ãƒ¬ã‚¤</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="statWin">0</div>
                <div class="stat-label">å‹ç‡%</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="statStreak">0</div>
                <div class="stat-label">é€£å‹</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="statBest">0</div>
                <div class="stat-label">æœ€å¤§é€£å‹</div>
            </div>
        </div>
        <div class="modal-buttons">
            <button class="btn btn-share" id="shareBtn"><i class="fas fa-share-alt"></i> çµæœã‚’ã‚·ã‚§ã‚¢</button>
            <button class="btn btn-primary" id="newGameBtn"><i class="fas fa-redo"></i> æ¬¡ã®åœ°å</button>
        </div>
    </div>
</div>

<!-- Share Options Modal -->
<div class="modal-overlay" id="shareModal">
    <div class="modal" style="width: 300px;">
        <button class="modal-close" id="shareClose">&times;</button>
        <h2 style="text-align: center;">çµæœã‚’ã‚·ã‚§ã‚¢</h2>
        <div class="modal-buttons" style="flex-direction: column; gap: 10px; margin-top: 20px;">
            <button class="btn btn-primary" id="twitterShareBtn" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px;">
                <i class="fab fa-twitter"></i> Twitterã§å…±æœ‰
            </button>
            <button class="btn btn-share" id="copyShareBtn" style="width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px;">
                <i class="fas fa-copy"></i> çµæœã‚’ã‚³ãƒ”ãƒ¼
            </button>
        </div>
    </div>
</div>

<!-- How to play Modal -->
<div class="modal-overlay" id="helpModal">
    <div class="modal">
        <button class="modal-close" id="helpClose">&times;</button>
        <h2>ğŸ—ºï¸ åœ°åWordleï¼ˆ5 Lettersï¼‰ãƒ«ãƒ¼ãƒ«</h2>
        <p>5æ–‡å­—ã®ã€Œæ—¥æœ¬ã®åœ°åï¼ˆéƒ½é“åºœçœŒãƒ»å¸‚åŒºç”ºæ‘ï¼‰ã€ã‚’å½“ã¦ã‚‹ã‚²ãƒ¼ãƒ ã§ã™ã€‚<br>6å›ä»¥å†…ã«æ­£è§£ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ï¼</p>

        <hr>

        <h3 style="font-size:0.95rem; margin-bottom:8px;">1. ç¶´ã‚Šã®ãƒ«ãƒ¼ãƒ«ï¼ˆãƒ˜ãƒœãƒ³å¼ï¼‰</h3>
        <p class="how-text" style="margin-bottom:6px;">è¡¨è¨˜ã¯ã€é“è·¯æ¨™è­˜ã‚„é§…åæ¨™ã§ä½¿ã‚ã‚Œã‚‹<strong>ã€Œæ¨™æº–çš„ãªãƒ˜ãƒœãƒ³å¼ãƒ­ãƒ¼ãƒå­—ã€</strong>ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚</p>

        <p class="how-text" style="margin-bottom:4px;">ğŸ”¹ <strong>é•·éŸ³ï¼ˆãƒ¼ï¼‰ã¯é‡ã­ãªã„ï¼š</strong><br>ã€Œã‚ªã‚ªã€ã€Œã‚ªã‚¦ã€ãªã©ã¯æ¯éŸ³ã‚’é‡ã­ãš1æ–‡å­—ã§è¡¨è¨˜ã—ã¾ã™ã€‚</p>
        <div class="how-example">
            <div class="how-tile" style="background:var(--correct);border-color:var(--correct);">O</div>
            <div class="how-tile" style="background:var(--correct);border-color:var(--correct);">S</div>
            <div class="how-tile" style="background:var(--correct);border-color:var(--correct);">A</div>
            <div class="how-tile" style="background:var(--correct);border-color:var(--correct);">K</div>
            <div class="how-tile" style="background:var(--correct);border-color:var(--correct);">A</div>
        </div>
        <p class="how-text" style="text-align:center;">å¤§é˜ªï¼šOSAKA ï¼ æ±äº¬ï¼šTOKYO ï¼ äº¬éƒ½ï¼šKYOTO</p>

        <p class="how-text" style="margin-bottom:4px;">ğŸ”¹ <strong>ã€Œã£ã€ã¯å­éŸ³ã‚’é‡ã­ã‚‹ï¼š</strong></p>
        <div class="how-example">
            <div class="how-tile" style="background:var(--present);border-color:var(--present);">B</div>
            <div class="how-tile" style="background:var(--present);border-color:var(--present);">E</div>
            <div class="how-tile" style="background:var(--present);border-color:var(--present);">P</div>
            <div class="how-tile" style="background:var(--present);border-color:var(--present);">P</div>
            <div class="how-tile" style="background:var(--present);border-color:var(--present);">U</div>
        </div>
        <p class="how-text" style="text-align:center;">åˆ¥åºœï¼šBEPPU</p>

        <p class="how-text" style="margin-bottom:4px;">ğŸ”¹ <strong>ã€Œã‚“ã€ã¯ã€ŒNã€ã§å›ºå®šï¼š</strong></p>
        <p class="how-text" style="text-align:center;">ç¾¤é¦¬ï¼šGUNMA ï¼ æ¹–å—ï¼šKONAN</p>

        <hr>

        <h3 style="font-size:0.95rem; margin-bottom:8px;">2. å½“ã¦ã¯ã¾ã‚‹å˜èª</h3>
        <p class="how-text" style="margin-bottom:4px;">ğŸ“ <strong>æ–‡å­—æ•°ï¼š</strong> ãƒ­ãƒ¼ãƒå­—ã§ã¡ã‚‡ã†ã©5æ–‡å­—ã®åœ°åã€‚</p>
        <p class="how-text" style="margin-bottom:4px;">ğŸ—¾ <strong>ç¯„å›²ï¼š</strong> æ—¥æœ¬å…¨å›½ã®éƒ½é“åºœçœŒåãƒ»å¸‚åŒºç”ºæ‘åã€‚</p>
        <p class="how-text" style="text-align:center;">ä¾‹ï¼‰AICHIï¼ˆçœŒï¼‰ã€SUITAï¼ˆå¸‚ï¼‰ã€TAIKIï¼ˆç”ºï¼‰ã€UMAJIï¼ˆæ‘ï¼‰</p>

        <hr>

        <h3 style="font-size:0.95rem; margin-bottom:8px;">3. ãƒ’ãƒ³ãƒˆã®è¦‹æ–¹</h3>
        <p class="how-text" style="margin-bottom:6px;">å„æ¨æ¸¬ã®å¾Œã€ã‚¿ã‚¤ãƒ«ã®è‰²ãŒå¤‰ã‚ã‚Šã¾ã™ï¼š</p>

        <div class="how-example">
            <div class="how-tile" style="background:var(--correct);border-color:var(--correct);">T</div>
            <div class="how-tile" style="border-color:var(--tile-border-filled);">O</div>
            <div class="how-tile" style="border-color:var(--tile-border-filled);">K</div>
            <div class="how-tile" style="border-color:var(--tile-border-filled);">Y</div>
            <div class="how-tile" style="border-color:var(--tile-border-filled);">O</div>
        </div>
        <p class="how-text">ğŸŸ© <strong>T</strong> ã¯æ­£è§£ã®æ–‡å­—ã§ã€æ­£ã—ã„ä½ç½®ã«ã‚ã‚Šã¾ã™ã€‚</p>

        <div class="how-example">
            <div class="how-tile" style="border-color:var(--tile-border-filled);">O</div>
            <div class="how-tile" style="background:var(--present);border-color:var(--present);">S</div>
            <div class="how-tile" style="border-color:var(--tile-border-filled);">A</div>
            <div class="how-tile" style="border-color:var(--tile-border-filled);">K</div>
            <div class="how-tile" style="border-color:var(--tile-border-filled);">A</div>
        </div>
        <p class="how-text">ğŸŸ¨ <strong>S</strong> ã¯æ­£è§£ã«å«ã¾ã‚Œã¾ã™ãŒã€ä½ç½®ãŒé•ã„ã¾ã™ã€‚</p>

        <div class="how-example">
            <div class="how-tile" style="border-color:var(--tile-border-filled);">C</div>
            <div class="how-tile" style="border-color:var(--tile-border-filled);">H</div>
            <div class="how-tile" style="background:var(--absent);border-color:var(--absent);">I</div>
            <div class="how-tile" style="border-color:var(--tile-border-filled);">B</div>
            <div class="how-tile" style="border-color:var(--tile-border-filled);">A</div>
        </div>
        <p class="how-text">â¬› <strong>I</strong> ã¯æ­£è§£ã«å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>

        <hr>
        <p style="font-size:0.85rem; color:#888; text-align:center;">ğŸ—ºï¸ æ­£è§£ã™ã‚‹ã¨ã€Google Mapã§ãã®åœ°åã®å ´æ‰€ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼</p>
    </div>
</div>

<!-- Stats Modal -->
<div class="modal-overlay" id="statsModal">
    <div class="modal">
        <button class="modal-close" id="statsClose">&times;</button>
        <h2>ğŸ“Š çµ±è¨ˆ</h2>
        <div class="result-stats">
            <div class="stat">
                <div class="stat-value" id="sStatPlayed">0</div>
                <div class="stat-label">ãƒ—ãƒ¬ã‚¤</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="sStatWin">0</div>
                <div class="stat-label">å‹ç‡%</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="sStatStreak">0</div>
                <div class="stat-label">é€£å‹</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="sStatBest">0</div>
                <div class="stat-label">æœ€å¤§é€£å‹</div>
            </div>
        </div>
        <div id="guessDistribution" style="padding: 0 20px;"></div>
    </div>
</div>

<!-- Ranking Modal -->
<div class="modal-overlay" id="rankingModal">
    <div class="modal" style="max-width: 500px;">
        <button class="modal-close" id="rankingClose">&times;</button>
        <h2>ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
        
        <div id="nicknameSection"></div>

        <div class="ranking-tabs">
            <button class="ranking-tab active" data-tab="streak" id="tabStreak">ğŸ”¥ ç¾åœ¨ã®é€£å‹</button>
            <button class="ranking-tab" data-tab="best" id="tabBest">â­ æœ€å¤§é€£å‹</button>
            <button class="ranking-tab" data-tab="winrate" id="tabWinrate">ğŸ“Š å‹ç‡</button>
        </div>

        <div id="myRankingBar"></div>
        <div class="ranking-list" id="rankingList">
            <div class="ranking-loading"><i class="fas fa-spinner"></i><br>èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>
    </div>
</div>

<!-- Nickname Registration Modal -->
<div class="modal-overlay" id="nicknameModal">
    <div class="modal" style="max-width: 380px;">
        <button class="modal-close" id="nicknameClose">&times;</button>
        <h2>ğŸ‘¤ ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ç™»éŒ²</h2>
        <p style="font-size:0.85rem; color:#666;">ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«è¡¨ç¤ºã•ã‚Œã‚‹åå‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚</p>
        <div class="nickname-input-group">
            <input type="text" id="nicknameInput" placeholder="ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ " maxlength="12">
            <button id="nicknameSubmit">ç™»éŒ²</button>
        </div>
        <p style="font-size:0.75rem; color:#aaa; text-align:center;">â€» 1ã€œ12æ–‡å­—ã§è¨­å®šã§ãã¾ã™</p>
    </div>
</div>

<!-- Confetti container -->
<div class="confetti-container" id="confetti"></div>

<!-- Firebase SDK (compat) -->
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

<script>
// ==============================
// FIREBASE INIT
// ==============================
const firebaseConfig = {
  apiKey: "AIzaSyCb_JgYML7rxfIloqjxt5y_1YSF__MiSaU",
  authDomain: "japan-wordle.firebaseapp.com",
  projectId: "japan-wordle",
  storageBucket: "japan-wordle.firebasestorage.app",
  messagingSenderId: "642967595639",
  appId: "1:642967595639:web:60f77076db8f984bf1b472",
  measurementId: "G-6YZRNSHTDW"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
// ==============================
// WORD LIST - 5æ–‡å­—ã®æ—¥æœ¬ã®åœ°å
// ==============================
const WORD_LIST = [
    { romaji: "AICHI", kanji: "æ„›çŸ¥", search: "æ„›çŸ¥çœŒ æ—¥æœ¬" },
    { romaji: "AKITA", kanji: "ç§‹ç”°", search: "ç§‹ç”°çœŒ æ—¥æœ¬" },
    { romaji: "CHIBA", kanji: "åƒè‘‰", search: "åƒè‘‰çœŒ æ—¥æœ¬" },
    { romaji: "EHIME", kanji: "æ„›åª›", search: "æ„›åª›çœŒ æ—¥æœ¬" },
    { romaji: "FUKUI", kanji: "ç¦äº•", search: "ç¦äº•çœŒ æ—¥æœ¬" },
    { romaji: "GUNMA", kanji: "ç¾¤é¦¬", search: "ç¾¤é¦¬çœŒ æ—¥æœ¬" },
    { romaji: "HYOGO", kanji: "å…µåº«", search: "å…µåº«çœŒ æ—¥æœ¬" },
    { romaji: "IWATE", kanji: "å²©æ‰‹", search: "å²©æ‰‹çœŒ æ—¥æœ¬" },
    { romaji: "KOCHI", kanji: "é«˜çŸ¥", search: "é«˜çŸ¥çœŒ æ—¥æœ¬" },
    { romaji: "KYOTO", kanji: "äº¬éƒ½", search: "äº¬éƒ½ æ—¥æœ¬" },
    { romaji: "OSAKA", kanji: "å¤§é˜ª", search: "å¤§é˜ª æ—¥æœ¬" },
    { romaji: "SHIGA", kanji: "æ»‹è³€", search: "æ»‹è³€çœŒ æ—¥æœ¬" },
    { romaji: "TOKYO", kanji: "æ±äº¬", search: "æ±äº¬ æ—¥æœ¬" },
    { romaji: "ATAMI", kanji: "ç†±æµ·", search: "ç†±æµ·å¸‚ æ—¥æœ¬" },
    { romaji: "NIKKO", kanji: "æ—¥å…‰", search: "æ—¥å…‰å¸‚ æ—¥æœ¬" },
    { romaji: "OTARU", kanji: "å°æ¨½", search: "å°æ¨½å¸‚ æ—¥æœ¬" },
    { romaji: "ASAHI", kanji: "æ—­", search: "æ—­å¸‚ åƒè‘‰ æ—¥æœ¬" },
    { romaji: "SAKAI", kanji: "å º", search: "å ºå¸‚ å¤§é˜ª æ—¥æœ¬" },
    { romaji: "SUITA", kanji: "å¹ç”°", search: "å¹ç”°å¸‚ å¤§é˜ª æ—¥æœ¬" },
    { romaji: "FUCHU", kanji: "åºœä¸­", search: "åºœä¸­å¸‚ æ±äº¬ æ—¥æœ¬" },
    { romaji: "IZUMO", kanji: "å‡ºé›²", search: "å‡ºé›²å¸‚ å³¶æ ¹ æ—¥æœ¬" },
    { romaji: "BEPPU", kanji: "åˆ¥åºœ", search: "åˆ¥åºœå¸‚ å¤§åˆ† æ—¥æœ¬" },
    { romaji: "FUSSA", kanji: "ç¦ç”Ÿ", search: "ç¦ç”Ÿå¸‚ æ±äº¬ æ—¥æœ¬" },
    { romaji: "CHOFU", kanji: "èª¿å¸ƒ", search: "èª¿å¸ƒå¸‚ æ±äº¬ æ—¥æœ¬" },
    { romaji: "IWAKI", kanji: "ã„ã‚ã", search: "ã„ã‚ãå¸‚ ç¦å³¶ æ—¥æœ¬" },
    { romaji: "OMIYA", kanji: "å¤§å®®", search: "å¤§å®® åŸ¼ç‰ æ—¥æœ¬" },
    { romaji: "TENRI", kanji: "å¤©ç†", search: "å¤©ç†å¸‚ å¥ˆè‰¯ æ—¥æœ¬" },
    { romaji: "BIZEN", kanji: "å‚™å‰", search: "å‚™å‰å¸‚ å²¡å±± æ—¥æœ¬" },
    { romaji: "ABIKO", kanji: "æˆ‘å­«å­", search: "æˆ‘å­«å­å¸‚ æ—¥æœ¬" },
    { romaji: "AMAMI", kanji: "å¥„ç¾", search: "å¥„ç¾å¤§å³¶ æ—¥æœ¬" },
    { romaji: "ASAGO", kanji: "æœæ¥", search: "æœæ¥å¸‚ å…µåº« æ—¥æœ¬" },
    { romaji: "AWAJI", kanji: "æ·¡è·¯", search: "æ·¡è·¯å³¶ æ—¥æœ¬" },
    { romaji: "AYASE", kanji: "ç¶¾ç€¬", search: "ç¶¾ç€¬å¸‚ ç¥å¥ˆå· æ—¥æœ¬" },
    { romaji: "BIBAI", kanji: "ç¾å”„", search: "ç¾å”„å¸‚ åŒ—æµ·é“ æ—¥æœ¬" },
    { romaji: "BANDO", kanji: "å‚æ±", search: "å‚æ±å¸‚ èŒ¨åŸ æ—¥æœ¬" },
    { romaji: "BUNGO", kanji: "è±Šå¾Œ", search: "è±Šå¾Œ å¤§åˆ† æ—¥æœ¬" },
    { romaji: "CHINO", kanji: "èŒ…é‡", search: "èŒ…é‡å¸‚ é•·é‡ æ—¥æœ¬" },
    { romaji: "CHITA", kanji: "çŸ¥å¤š", search: "çŸ¥å¤šå¸‚ æ„›çŸ¥ æ—¥æœ¬" },
    { romaji: "CHIZU", kanji: "æ™ºé ­", search: "æ™ºé ­ç”º é³¥å– æ—¥æœ¬" },
    { romaji: "DAITO", kanji: "å¤§æ±", search: "å¤§æ±å¸‚ å¤§é˜ª æ—¥æœ¬" },
    { romaji: "EBINA", kanji: "æµ·è€å", search: "æµ·è€åå¸‚ ç¥å¥ˆå· æ—¥æœ¬" },
    { romaji: "ENIWA", kanji: "æµåº­", search: "æµåº­å¸‚ åŒ—æµ·é“ æ—¥æœ¬" },
    { romaji: "ENZAN", kanji: "å¡©å±±", search: "å¡©å±± å±±æ¢¨ æ—¥æœ¬" },
    { romaji: "FUKAE", kanji: "æ·±æ±Ÿ", search: "æ·±æ±Ÿ å…µåº« æ—¥æœ¬" },
    { romaji: "GYODA", kanji: "è¡Œç”°", search: "è¡Œç”°å¸‚ åŸ¼ç‰ æ—¥æœ¬" },
    { romaji: "GOSEN", kanji: "äº”æ³‰", search: "äº”æ³‰å¸‚ æ–°æ½Ÿ æ—¥æœ¬" },
    { romaji: "GOTSU", kanji: "æ±Ÿæ´¥", search: "æ±Ÿæ´¥å¸‚ å³¶æ ¹ æ—¥æœ¬" },
    { romaji: "HANDA", kanji: "åŠç”°", search: "åŠç”°å¸‚ æ„›çŸ¥ æ—¥æœ¬" },
    { romaji: "HANYU", kanji: "ç¾½ç”Ÿ", search: "ç¾½ç”Ÿå¸‚ åŸ¼ç‰ æ—¥æœ¬" },
    { romaji: "HANNO", kanji: "é£¯èƒ½", search: "é£¯èƒ½å¸‚ åŸ¼ç‰ æ—¥æœ¬" },
    { romaji: "HAPPO", kanji: "å…«å³°", search: "å…«å³°ç”º ç§‹ç”° æ—¥æœ¬" },
    { romaji: "HIOKI", kanji: "æ—¥ç½®", search: "æ—¥ç½®å¸‚ é¹¿å…å³¶ æ—¥æœ¬" },
    { romaji: "HIROO", kanji: "åºƒå°¾", search: "åºƒå°¾ç”º åŒ—æµ·é“ æ—¥æœ¬" },
    { romaji: "HIZEN", kanji: "è‚¥å‰", search: "è‚¥å‰ ä½è³€ æ—¥æœ¬" },
    { romaji: "HONJO", kanji: "æœ¬åº„", search: "æœ¬åº„å¸‚ åŸ¼ç‰ æ—¥æœ¬" },
    { romaji: "HYUGA", kanji: "æ—¥å‘", search: "æ—¥å‘å¸‚ å®®å´ æ—¥æœ¬" },
    { romaji: "IKEDA", kanji: "æ± ç”°", search: "æ± ç”°å¸‚ å¤§é˜ª æ—¥æœ¬" },
    { romaji: "IKOMA", kanji: "ç”Ÿé§’", search: "ç”Ÿé§’å¸‚ å¥ˆè‰¯ æ—¥æœ¬" },
    { romaji: "IMARI", kanji: "ä¼Šä¸‡é‡Œ", search: "ä¼Šä¸‡é‡Œå¸‚ ä½è³€ æ—¥æœ¬" },
    { romaji: "INABE", kanji: "ã„ãªã¹", search: "ã„ãªã¹å¸‚ ä¸‰é‡ æ—¥æœ¬" },
    { romaji: "INAGI", kanji: "ç¨²åŸ", search: "ç¨²åŸå¸‚ æ±äº¬ æ—¥æœ¬" },
    { romaji: "INAMI", kanji: "å°å—", search: "å°å—ç”º å’Œæ­Œå±± æ—¥æœ¬" },
    { romaji: "IRUMA", kanji: "å…¥é–“", search: "å…¥é–“å¸‚ åŸ¼ç‰ æ—¥æœ¬" },
    { romaji: "ISUMI", kanji: "ã„ã™ã¿", search: "ã„ã™ã¿å¸‚ åƒè‘‰ æ—¥æœ¬" },
    { romaji: "ITAKO", kanji: "æ½®æ¥", search: "æ½®æ¥å¸‚ èŒ¨åŸ æ—¥æœ¬" },
    { romaji: "ITAMI", kanji: "ä¼Šä¸¹", search: "ä¼Šä¸¹å¸‚ å…µåº« æ—¥æœ¬" },
    { romaji: "ITANO", kanji: "æ¿é‡", search: "æ¿é‡ç”º å¾³å³¶ æ—¥æœ¬" },
    { romaji: "IWADE", kanji: "å²©å‡º", search: "å²©å‡ºå¸‚ å’Œæ­Œå±± æ—¥æœ¬" },
    { romaji: "IWAMI", kanji: "å²©ç¾", search: "å²©ç¾ç”º é³¥å– æ—¥æœ¬" },
    { romaji: "IWATA", kanji: "ç£ç”°", search: "ç£ç”°å¸‚ é™å²¡ æ—¥æœ¬" },
    { romaji: "IZUMI", kanji: "å’Œæ³‰", search: "å’Œæ³‰å¸‚ å¤§é˜ª æ—¥æœ¬" },
    { romaji: "KAIZU", kanji: "æµ·æ´¥", search: "æµ·æ´¥å¸‚ å²é˜œ æ—¥æœ¬" },
    { romaji: "KANIE", kanji: "èŸ¹æ±Ÿ", search: "èŸ¹æ±Ÿç”º æ„›çŸ¥ æ—¥æœ¬" },
    { romaji: "KANNA", kanji: "ç¥æµ", search: "ç¥æµç”º ç¾¤é¦¬ æ—¥æœ¬" },
    { romaji: "KANRA", kanji: "ç”˜æ¥½", search: "ç”˜æ¥½ç”º ç¾¤é¦¬ æ—¥æœ¬" },
    { romaji: "KASAI", kanji: "åŠ è¥¿", search: "åŠ è¥¿å¸‚ å…µåº« æ—¥æœ¬" },
    { romaji: "KAWAI", kanji: "æ²³åˆ", search: "æ²³åˆç”º å¥ˆè‰¯ æ—¥æœ¬" },
    { romaji: "KINKO", kanji: "éŒ¦æ±Ÿ", search: "éŒ¦æ±Ÿç”º é¹¿å…å³¶ æ—¥æœ¬" },
    { romaji: "KIRYU", kanji: "æ¡ç”Ÿ", search: "æ¡ç”Ÿå¸‚ ç¾¤é¦¬ æ—¥æœ¬" },
    { romaji: "KOMAE", kanji: "ç‹›æ±Ÿ", search: "ç‹›æ±Ÿå¸‚ æ±äº¬ æ—¥æœ¬" },
    { romaji: "KONAN", kanji: "æ¹–å—", search: "æ¹–å—å¸‚ æ»‹è³€ æ—¥æœ¬" },
    { romaji: "KORYO", kanji: "åºƒé™µ", search: "åºƒé™µç”º å¥ˆè‰¯ æ—¥æœ¬" },
    { romaji: "KOSAI", kanji: "æ¹–è¥¿", search: "æ¹–è¥¿å¸‚ é™å²¡ æ—¥æœ¬" },
    { romaji: "KOSHI", kanji: "åˆå¿—", search: "åˆå¿—å¸‚ ç†Šæœ¬ æ—¥æœ¬" },
    { romaji: "MEIWA", kanji: "æ˜å’Œ", search: "æ˜å’Œç”º ä¸‰é‡ æ—¥æœ¬" },
    { romaji: "MINOO", kanji: "ç®•é¢", search: "ç®•é¢å¸‚ å¤§é˜ª æ—¥æœ¬" },
    { romaji: "MIURA", kanji: "ä¸‰æµ¦", search: "ä¸‰æµ¦å¸‚ ç¥å¥ˆå· æ—¥æœ¬" },
    { romaji: "MUTSU", kanji: "ã‚€ã¤", search: "ã‚€ã¤å¸‚ é’æ£® æ—¥æœ¬" },
    { romaji: "MYOKO", kanji: "å¦™é«˜", search: "å¦™é«˜å¸‚ æ–°æ½Ÿ æ—¥æœ¬" },
    { romaji: "NAGAI", kanji: "é•·äº•", search: "é•·äº•å¸‚ å±±å½¢ æ—¥æœ¬" },
    { romaji: "NAMIE", kanji: "æµªæ±Ÿ", search: "æµªæ±Ÿç”º ç¦å³¶ æ—¥æœ¬" },
    { romaji: "NANBU", kanji: "å—éƒ¨", search: "å—éƒ¨ç”º å±±æ¢¨ æ—¥æœ¬" },
    { romaji: "NANJO", kanji: "å—åŸ", search: "å—åŸå¸‚ æ²–ç¸„ æ—¥æœ¬" },
    { romaji: "NANTO", kanji: "å—ç º", search: "å—ç ºå¸‚ å¯Œå±± æ—¥æœ¬" },
    { romaji: "NANYO", kanji: "å—é™½", search: "å—é™½å¸‚ å±±å½¢ æ—¥æœ¬" },
    { romaji: "OBAMA", kanji: "å°æµœ", search: "å°æµœå¸‚ ç¦äº• æ—¥æœ¬" },
    { romaji: "OGAKI", kanji: "å¤§å£", search: "å¤§å£å¸‚ å²é˜œ æ—¥æœ¬" },
    { romaji: "OGANO", kanji: "å°é¹¿é‡", search: "å°é¹¿é‡ç”º åŸ¼ç‰ æ—¥æœ¬" },
    { romaji: "OGAWA", kanji: "å°å·", search: "å°å·ç”º åŸ¼ç‰ æ—¥æœ¬" },
    { romaji: "OGIMI", kanji: "å¤§å®œå‘³", search: "å¤§å®œå‘³æ‘ æ²–ç¸„ æ—¥æœ¬" },
    { romaji: "OGUNI", kanji: "å°å›½", search: "å°å›½ç”º ç†Šæœ¬ æ—¥æœ¬" },
    { romaji: "OHARA", kanji: "å¤§åŸ", search: "å¤§åŸ äº¬éƒ½ æ—¥æœ¬" },
    { romaji: "OJIYA", kanji: "å°åƒè°·", search: "å°åƒè°·å¸‚ æ–°æ½Ÿ æ—¥æœ¬" },
    { romaji: "OKAWA", kanji: "å¤§å·", search: "å¤§å·å¸‚ ç¦å²¡ æ—¥æœ¬" },
    { romaji: "OKAYA", kanji: "å²¡è°·", search: "å²¡è°·å¸‚ é•·é‡ æ—¥æœ¬" },
    { romaji: "OMURA", kanji: "å¤§æ‘", search: "å¤§æ‘å¸‚ é•·å´ æ—¥æœ¬" },
    { romaji: "OMUTA", kanji: "å¤§ç‰Ÿç”°", search: "å¤§ç‰Ÿç”°å¸‚ ç¦å²¡ æ—¥æœ¬" },
    { romaji: "ONOJO", kanji: "å¤§é‡åŸ", search: "å¤§é‡åŸå¸‚ ç¦å²¡ æ—¥æœ¬" },
    { romaji: "OTAKE", kanji: "å¤§ç«¹", search: "å¤§ç«¹å¸‚ åºƒå³¶ æ—¥æœ¬" },
    { romaji: "OTAKI", kanji: "å¤§å¤šå–œ", search: "å¤§å¤šå–œç”º åƒè‘‰ æ—¥æœ¬" },
    { romaji: "OTARI", kanji: "å°è°·", search: "å°è°·æ‘ é•·é‡ æ—¥æœ¬" },
    { romaji: "OWASE", kanji: "å°¾é·²", search: "å°¾é·²å¸‚ ä¸‰é‡ æ—¥æœ¬" },
    { romaji: "OYAMA", kanji: "å°å±±", search: "å°å±±å¸‚ æ ƒæœ¨ æ—¥æœ¬" },
    { romaji: "OYODO", kanji: "å¤§æ·€", search: "å¤§æ·€ç”º å¥ˆè‰¯ æ—¥æœ¬" },
    { romaji: "OZORA", kanji: "å¤§ç©º", search: "å¤§ç©ºç”º åŒ—æµ·é“ æ—¥æœ¬" },
    { romaji: "SABAE", kanji: "é¯–æ±Ÿ", search: "é¯–æ±Ÿå¸‚ ç¦äº• æ—¥æœ¬" },
    { romaji: "SAIJO", kanji: "è¥¿æ¡", search: "è¥¿æ¡å¸‚ æ„›åª› æ—¥æœ¬" },
    { romaji: "SEIYO", kanji: "è¥¿äºˆ", search: "è¥¿äºˆå¸‚ æ„›åª› æ—¥æœ¬" },
    { romaji: "SHIKA", kanji: "å¿—è³€", search: "å¿—è³€ç”º çŸ³å· æ—¥æœ¬" },
    { romaji: "SHOWA", kanji: "æ˜­å’Œ", search: "æ˜­å’Œç”º å±±æ¢¨ æ—¥æœ¬" },
    { romaji: "TAIKI", kanji: "å¤§æ¨¹", search: "å¤§æ¨¹ç”º åŒ—æµ·é“ æ—¥æœ¬" },
    { romaji: "TAIJI", kanji: "å¤ªåœ°", search: "å¤ªåœ°ç”º å’Œæ­Œå±± æ—¥æœ¬" },
    { romaji: "TAIWA", kanji: "å¤§å’Œ", search: "å¤§å’Œç”º å®®åŸ æ—¥æœ¬" },
    { romaji: "TARUI", kanji: "å‚äº•", search: "å‚äº•ç”º å²é˜œ æ—¥æœ¬" },
    { romaji: "TSURU", kanji: "éƒ½ç•™", search: "éƒ½ç•™å¸‚ å±±æ¢¨ æ—¥æœ¬" },
    { romaji: "USUKI", kanji: "è‡¼æµ", search: "è‡¼æµå¸‚ å¤§åˆ† æ—¥æœ¬" },
    { romaji: "YAESE", kanji: "å…«é‡ç€¬", search: "å…«é‡ç€¬ç”º æ²–ç¸„ æ—¥æœ¬" },
    { romaji: "YAITA", kanji: "çŸ¢æ¿", search: "çŸ¢æ¿å¸‚ æ ƒæœ¨ æ—¥æœ¬" },
    { romaji: "YORII", kanji: "å¯„å±…", search: "å¯„å±…ç”º åŸ¼ç‰ æ—¥æœ¬" },
    { romaji: "YUASA", kanji: "æ¹¯æµ…", search: "æ¹¯æµ…ç”º å’Œæ­Œå±± æ—¥æœ¬" },
    { romaji: "PIPPU", kanji: "æ¯”å¸ƒ", search: "æ¯”å¸ƒç”º åŒ—æµ·é“ æ—¥æœ¬" },
    { romaji: "ERIMO", kanji: "è¥Ÿè£³", search: "ãˆã‚Šã‚‚ç”º åŒ—æµ·é“ æ—¥æœ¬" },
    { romaji: "OKETO", kanji: "ç½®æˆ¸", search: "ç½®æˆ¸ç”º åŒ—æµ·é“ æ—¥æœ¬" },
    { romaji: "RAUSU", kanji: "ç¾…è‡¼", search: "ç¾…è‡¼ç”º åŒ—æµ·é“ æ—¥æœ¬" },
    { romaji: "OKUMA", kanji: "å¤§ç†Š", search: "å¤§ç†Šç”º ç¦å³¶ æ—¥æœ¬" },
    { romaji: "OARAI", kanji: "å¤§æ´—", search: "å¤§æ´—ç”º èŒ¨åŸ æ—¥æœ¬" },
    { romaji: "DAIGO", kanji: "å¤§å­", search: "å¤§å­ç”º èŒ¨åŸ æ—¥æœ¬" },
    { romaji: "OGOSE", kanji: "è¶Šç”Ÿ", search: "è¶Šç”Ÿç”º åŸ¼ç‰ æ—¥æœ¬" },
    { romaji: "DOSHI", kanji: "é“å¿—", search: "é“å¿—æ‘ å±±æ¢¨ æ—¥æœ¬" },
    { romaji: "KANAN", kanji: "æ²³å—", search: "æ²³å—ç”º å¤§é˜ª æ—¥æœ¬" },
    { romaji: "KAITA", kanji: "æµ·ç”°", search: "æµ·ç”°ç”º åºƒå³¶ æ—¥æœ¬" },
    { romaji: "IKATA", kanji: "ä¼Šæ–¹", search: "ä¼Šæ–¹ç”º æ„›åª› æ—¥æœ¬" },
    { romaji: "AINAN", kanji: "æ„›å—", search: "æ„›å—ç”º æ„›åª› æ—¥æœ¬" },
    { romaji: "UMAJI", kanji: "é¦¬è·¯", search: "é¦¬è·¯æ‘ é«˜çŸ¥ æ—¥æœ¬" },
    { romaji: "SHIME", kanji: "å¿—å…", search: "å¿—å…ç”º ç¦å²¡ æ—¥æœ¬" },
    { romaji: "KANDA", kanji: "è‹…ç”°", search: "è‹…ç”°ç”º ç¦å²¡ æ—¥æœ¬" },
    { romaji: "SOEDA", kanji: "æ·»ç”°", search: "æ·»ç”°ç”º ç¦å²¡ æ—¥æœ¬" },
    { romaji: "ITODA", kanji: "ç³¸ç”°", search: "ç³¸ç”°ç”º ç¦å²¡ æ—¥æœ¬" },
    { romaji: "OJIKA", kanji: "å°å€¤è³€", search: "å°å€¤è³€ç”º é•·å´ æ—¥æœ¬" },
    { romaji: "YAMAE", kanji: "å±±æ±Ÿ", search: "å±±æ±Ÿæ‘ ç†Šæœ¬ æ—¥æœ¬" },
    { romaji: "TSUNO", kanji: "éƒ½è¾²", search: "éƒ½è¾²ç”º å®®å´ æ—¥æœ¬" },
    { romaji: "KIKAI", kanji: "å–œç•Œ", search: "å–œç•Œç”º é¹¿å…å³¶ æ—¥æœ¬" },
    { romaji: "CHINA", kanji: "çŸ¥å", search: "çŸ¥åç”º é¹¿å…å³¶ æ—¥æœ¬" },
    { romaji: "YORON", kanji: "ä¸è«–", search: "ä¸è«–ç”º é¹¿å…å³¶ æ—¥æœ¬" },
    { romaji: "AGUNI", kanji: "ç²Ÿå›½", search: "ç²Ÿå›½æ‘ æ²–ç¸„ æ—¥æœ¬" },
    { romaji: "IHEYA", kanji: "ä¼Šå¹³å±‹", search: "ä¼Šå¹³å±‹æ‘ æ²–ç¸„ æ—¥æœ¬" },
    { romaji: "IZENA", kanji: "ä¼Šæ˜¯å", search: "ä¼Šæ˜¯åæ‘ æ²–ç¸„ æ—¥æœ¬" },
    { romaji: "UMEDA", kanji: "æ¢…ç”°", search: "æ¢…ç”° å¤§é˜ª æ—¥æœ¬" },
    { romaji: "NAMBA", kanji: "é›£æ³¢", search: "é›£æ³¢ å¤§é˜ª æ—¥æœ¬" },
    { romaji: "SAKAE", kanji: "æ „", search: "æ „ åå¤å±‹ æ—¥æœ¬" },
    { romaji: "EBISU", kanji: "æµæ¯”å¯¿", search: "æµæ¯”å¯¿ æ±äº¬ æ—¥æœ¬" },
    { romaji: "GINZA", kanji: "éŠ€åº§", search: "éŠ€åº§ æ±äº¬ æ—¥æœ¬" },
];

// Remove duplicates by romaji
const uniqueWords = [];
const seenRomaji = new Set();
WORD_LIST.forEach(w => {
    const key = w.romaji.toUpperCase();
    if (!seenRomaji.has(key)) {
        seenRomaji.add(key);
        uniqueWords.push(w);
    }
});

// All valid romaji words (for checking if input is valid)
const VALID_WORDS = new Set(uniqueWords.map(w => w.romaji.toUpperCase()));

// ==============================
// GAME STATE
// ==============================
const MAX_GUESSES = 6;
const WORD_LENGTH = 5;

let answer = null;
let currentRow = 0;
let currentCol = 0;
let guesses = [];
let gameOver = false;
let isRevealing = false;
let currentGuess = "";

// ==============================
// STATS
// ==============================
function loadStats() {
    const def = { played: 0, won: 0, streak: 0, bestStreak: 0, distribution: {1:0,2:0,3:0,4:0,5:0,6:0} };
    try {
        return JSON.parse(localStorage.getItem('chimeidle-stats')) || def;
    } catch { return def; }
}

function saveStats(stats) {
    localStorage.setItem('chimeidle-stats', JSON.stringify(stats));
}

function updateStatsDisplay(prefix) {
    const stats = loadStats();
    const winRate = stats.played > 0 ? Math.round((stats.won / stats.played) * 100) : 0;
    document.getElementById(prefix + 'Played').textContent = stats.played;
    document.getElementById(prefix + 'Win').textContent = winRate;
    document.getElementById(prefix + 'Streak').textContent = stats.streak;
    document.getElementById(prefix + 'Best').textContent = stats.bestStreak;
}

// ==============================
// GAME FUNCTIONS
// ==============================
function pickWord() {
    const idx = Math.floor(Math.random() * uniqueWords.length);
    return uniqueWords[idx];
}

function initGame() {
    answer = pickWord();
    currentRow = 0;
    currentCol = 0;
    guesses = [];
    gameOver = false;
    isRevealing = false;
    currentGuess = "";
    
    buildBoard();
    buildKeyboard();
    
    console.log("Debug answer:", answer.romaji);
}

function buildBoard() {
    const board = document.getElementById('board');
    board.innerHTML = '';
    for (let r = 0; r < MAX_GUESSES; r++) {
        const row = document.createElement('div');
        row.className = 'row';
        row.id = `row-${r}`;
        for (let c = 0; c < WORD_LENGTH; c++) {
            const tile = document.createElement('div');
            tile.className = 'tile';
            tile.id = `tile-${r}-${c}`;
            row.appendChild(tile);
        }
        board.appendChild(row);
    }
}

function buildKeyboard() {
    const kb = document.getElementById('keyboard');
    kb.innerHTML = '';
    const rows = [
        ['Q','W','E','R','T','Y','U','I','O','P'],
        ['A','S','D','F','G','H','J','K','L'],
        ['ENTER','Z','X','C','V','B','N','M','âŒ«']
    ];
    
    rows.forEach(row => {
        const rowDiv = document.createElement('div');
        rowDiv.className = 'kb-row';
        row.forEach(key => {
            const btn = document.createElement('button');
            btn.className = 'key' + (key === 'ENTER' || key === 'âŒ«' ? ' wide' : '');
            btn.textContent = key;
            btn.id = `key-${key}`;
            btn.setAttribute('data-key', key);
            btn.addEventListener('click', () => handleKey(key));
            rowDiv.appendChild(btn);
        });
        kb.appendChild(rowDiv);
    });
}

function handleKey(key) {
    if (gameOver || isRevealing) return;
    if (key === 'ENTER') {
        submitGuess();
    } else if (key === 'âŒ«') {
        deleteLetter();
    } else if (/^[A-Z]$/.test(key)) {
        addLetter(key);
    }
}

function addLetter(letter) {
    if (currentCol >= WORD_LENGTH) return;
    
    const tile = document.getElementById(`tile-${currentRow}-${currentCol}`);
    tile.textContent = letter;
    tile.classList.add('filled');
    currentGuess += letter;
    currentCol++;
}

function deleteLetter() {
    if (currentCol <= 0) return;
    
    currentCol--;
    const tile = document.getElementById(`tile-${currentRow}-${currentCol}`);
    tile.textContent = '';
    tile.classList.remove('filled');
    currentGuess = currentGuess.slice(0, -1);
}

function submitGuess() {
    if (currentGuess.length < WORD_LENGTH) {
        shakeRow(currentRow);
        showToast("5æ–‡å­—å…¥åŠ›ã—ã¦ãã ã•ã„");
        return;
    }
    
    if (!VALID_WORDS.has(currentGuess.toUpperCase())) {
        shakeRow(currentRow);
        showToast("ãƒªã‚¹ãƒˆã«ãªã„åœ°åã§ã™");
        return;
    }
    
    const guess = currentGuess.toUpperCase();
    const answerStr = answer.romaji.toUpperCase();
    guesses.push(guess);
    
    // Calculate results
    const result = evaluateGuess(guess, answerStr);
    
    // Reveal tiles with animation
    isRevealing = true;
    revealRow(currentRow, result, guess);
    
    const won = guess === answerStr;
    const lastGuess = currentRow === MAX_GUESSES - 1;
    
    setTimeout(() => {
        isRevealing = false;
        updateKeyboard(result, guess);
        
        if (won) {
            gameOver = true;
            // Win animation
            setTimeout(() => {
                for (let c = 0; c < WORD_LENGTH; c++) {
                    const tile = document.getElementById(`tile-${currentRow}-${c}`);
                    setTimeout(() => tile.classList.add('win'), c * 100);
                }
            }, 200);
            
            // Update stats
            const stats = loadStats();
            stats.played++;
            stats.won++;
            stats.streak++;
            if (stats.streak > stats.bestStreak) stats.bestStreak = stats.streak;
            stats.distribution[currentRow + 1]++;
            saveStats(stats);
            
            // Sync ranking to server
            syncRankingToServer();
            
            setTimeout(() => {
                showConfetti();
                showResult(true, currentRow + 1);
            }, 1500);
        } else if (lastGuess) {
            gameOver = true;
            
            const stats = loadStats();
            stats.played++;
            stats.streak = 0;
            saveStats(stats);
            
            // Sync ranking to server
            syncRankingToServer();
            
            setTimeout(() => {
                showResult(false, null);
            }, 1200);
        }
        
        currentRow++;
        currentCol = 0;
        currentGuess = "";
    }, WORD_LENGTH * 350 + 200);
}

function evaluateGuess(guess, answerStr) {
    const result = Array(WORD_LENGTH).fill('absent');
    const answerArr = answerStr.split('');
    const guessArr = guess.split('');
    const used = Array(WORD_LENGTH).fill(false);
    
    // First pass: correct
    for (let i = 0; i < WORD_LENGTH; i++) {
        if (guessArr[i] === answerArr[i]) {
            result[i] = 'correct';
            used[i] = true;
        }
    }
    
    // Second pass: present
    for (let i = 0; i < WORD_LENGTH; i++) {
        if (result[i] === 'correct') continue;
        for (let j = 0; j < WORD_LENGTH; j++) {
            if (!used[j] && guessArr[i] === answerArr[j]) {
                result[i] = 'present';
                used[j] = true;
                break;
            }
        }
    }
    
    return result;
}

function revealRow(row, result, guess) {
    for (let c = 0; c < WORD_LENGTH; c++) {
        const tile = document.getElementById(`tile-${row}-${c}`);
        setTimeout(() => {
            tile.classList.add('reveal');
            setTimeout(() => {
                tile.classList.add(result[c]);
            }, 250);
        }, c * 350);
    }
}

function updateKeyboard(result, guess) {
    const priority = { 'correct': 3, 'present': 2, 'absent': 1 };
    
    for (let i = 0; i < WORD_LENGTH; i++) {
        const letter = guess[i];
        const key = document.getElementById(`key-${letter}`);
        if (!key) continue;
        
        const currentClass = key.classList.contains('correct') ? 'correct' : 
                           key.classList.contains('present') ? 'present' : 
                           key.classList.contains('absent') ? 'absent' : null;
        
        const currentPriority = currentClass ? priority[currentClass] : 0;
        const newPriority = priority[result[i]];
        
        if (newPriority > currentPriority) {
            key.classList.remove('correct', 'present', 'absent');
            key.classList.add(result[i]);
        }
    }
}

function shakeRow(row) {
    const rowEl = document.getElementById(`row-${row}`);
    rowEl.querySelectorAll('.tile').forEach(tile => {
        tile.classList.add('shake');
        setTimeout(() => tile.classList.remove('shake'), 500);
    });
}

// ==============================
// TOAST
// ==============================
function showToast(msg) {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = msg;
    container.appendChild(toast);
    setTimeout(() => toast.remove(), 1600);
}

// ==============================
// RESULT MODAL + GOOGLE MAP
// ==============================
function showResult(won, attempts) {
    const modal = document.getElementById('resultModal');
    
    document.getElementById('resultIcon').textContent = won ? 'ğŸ‰' : 'ğŸ˜¢';
    document.getElementById('resultTitle').textContent = won ? 'ã™ã°ã‚‰ã—ã„ï¼' : 'æ®‹å¿µ...';
    
    const answerEl = document.getElementById('resultAnswer');
    answerEl.textContent = answer.romaji;
    answerEl.className = 'result-answer' + (won ? '' : ' lost');
    
    document.getElementById('resultKanji').textContent = answer.kanji;
    
    // Google Map embed
    const mapContainer = document.getElementById('map-container');
    const searchQuery = encodeURIComponent(answer.search);
    mapContainer.innerHTML = `<iframe 
        src="https://maps.google.com/maps?q=${searchQuery}&output=embed&z=10" 
        allowfullscreen loading="lazy" referrerpolicy="no-referrer-when-downgrade">
    </iframe>`;
    
    document.getElementById('mapLabelText').textContent = `${answer.kanji}ï¼ˆ${answer.romaji}ï¼‰ã®å ´æ‰€`;
    
    updateStatsDisplay('stat');
    
    modal.classList.add('active');
}

function closeResult() {
    document.getElementById('resultModal').classList.remove('active');
}

// ==============================
// SHARE
// ==============================
function getShareText() {
    const won = guesses[guesses.length - 1] === answer.romaji.toUpperCase();
    const attemptStr = won ? guesses.length : 'X';
    
    let text = `â›©ï¸ æ—¥æœ¬ã®åœ°åã§Wordle ${attemptStr}/6\n\n`;
    
    const answerStr = answer.romaji.toUpperCase();
    guesses.forEach(guess => {
        const result = evaluateGuess(guess, answerStr);
        const emojiMap = { correct: 'ğŸŸ©', present: 'ğŸŸ¨', absent: 'â¬›' };
        text += result.map(r => emojiMap[r]).join('') + '\n';
    });
    
    return text;
}

function copyResultToClipboard() {
    const text = getShareText();
    
    if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => {
            showToast("çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
            closeShareModal();
        });
    } else {
        // Fallback
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        showToast("çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
        closeShareModal();
    }
}

function shareOnTwitter() {
    const text = getShareText();
    const gameUrl = window.location.href;
    const tweetText = `${text}\n${gameUrl}`;
    
    // Twitter Web Intent
    const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}`;
    window.open(twitterUrl, 'twitter-share', 'width=600,height=400');
    closeShareModal();
}

function openShareModal() {
    document.getElementById('shareModal').classList.add('active');
}

function closeShareModal() {
    document.getElementById('shareModal').classList.remove('active');
}

function shareResult() {
    openShareModal();
}

// ==============================
// CONFETTI
// ==============================
function showConfetti() {
    const container = document.getElementById('confetti');
    container.innerHTML = '';
    const colors = ['#6aaa64', '#c9b458', '#f8b4c8', '#ff6b6b', '#4ecdc4', '#45b7d1', '#ffd93d'];
    
    for (let i = 0; i < 60; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.width = (Math.random() * 8 + 5) + 'px';
        confetti.style.height = (Math.random() * 8 + 5) + 'px';
        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
        confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
        confetti.style.animationDelay = Math.random() * 0.5 + 's';
        container.appendChild(confetti);
    }
    
    setTimeout(() => container.innerHTML = '', 4000);
}

// ==============================
// SAKURA PETALS
// ==============================
function createSakura() {
    const container = document.getElementById('sakura');
    for (let i = 0; i < 15; i++) {
        const petal = document.createElement('div');
        petal.className = 'sakura-petal';
        petal.style.left = Math.random() * 100 + '%';
        petal.style.animationDuration = (Math.random() * 8 + 6) + 's';
        petal.style.animationDelay = Math.random() * 10 + 's';
        petal.style.width = (Math.random() * 8 + 8) + 'px';
        petal.style.height = (Math.random() * 8 + 8) + 'px';
        petal.style.opacity = Math.random() * 0.4 + 0.2;
        container.appendChild(petal);
    }
}

// ==============================
// MODALS
// ==============================
function showHelp() {
    document.getElementById('helpModal').classList.add('active');
}

function showStats() {
    const stats = loadStats();
    updateStatsDisplay('sStat');
    
    // Distribution
    const dist = document.getElementById('guessDistribution');
    dist.innerHTML = '<h3 style="text-align:center; margin-bottom:12px; font-size:0.9rem;">æ¨æ¸¬ã®åˆ†å¸ƒ</h3>';
    const maxVal = Math.max(...Object.values(stats.distribution || {}), 1);
    
    for (let i = 1; i <= 6; i++) {
        const val = (stats.distribution && stats.distribution[i]) || 0;
        const pct = (val / maxVal) * 100;
        dist.innerHTML += `
            <div style="display:flex; align-items:center; gap:8px; margin-bottom:4px;">
                <span style="font-weight:700; width:14px; text-align:right;">${i}</span>
                <div style="flex:1; background:#eee; border-radius:4px; overflow:hidden; height:22px;">
                    <div style="width:${Math.max(pct, 8)}%; background:${val > 0 ? 'var(--correct)' : '#ccc'}; height:100%; display:flex; align-items:center; justify-content:flex-end; padding-right:6px; border-radius:4px; color:#fff; font-size:0.75rem; font-weight:700; min-width:24px;">
                        ${val}
                    </div>
                </div>
            </div>
        `;
    }
    
    document.getElementById('statsModal').classList.add('active');
}

// ==============================
// RANKING SYSTEM
// ==============================
let currentRankingTab = 'streak';

function getPlayerId() {
    let id = localStorage.getItem('chimeidle-player-id');
    if (!id) {
        id = 'p_' + crypto.randomUUID();
        localStorage.setItem('chimeidle-player-id', id);
    }
    return id;
}

function getPlayerName() {
    return localStorage.getItem('chimeidle-player-name') || '';
}

function setPlayerName(name) {
    localStorage.setItem('chimeidle-player-name', name);
}

function renderNicknameSection() {
    const section = document.getElementById('nicknameSection');
    const name = getPlayerName();
    if (name) {
        section.innerHTML = `
            <div class="nickname-display">
                <i class="fas fa-user"></i> <strong>${escapeHTML(name)}</strong>
                <span class="change-name" id="changeNameBtn">å¤‰æ›´</span>
            </div>
        `;
        document.getElementById('changeNameBtn').addEventListener('click', () => {
            openNicknameModal();
        });
    } else {
        section.innerHTML = `
            <div style="text-align:center; margin: 12px 0;">
                <button class="btn btn-primary" id="registerNameBtn" style="font-size:0.85rem; padding:8px 20px;">
                    <i class="fas fa-user-plus"></i> ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’ç™»éŒ²ã—ã¦ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«å‚åŠ 
                </button>
            </div>
        `;
        document.getElementById('registerNameBtn').addEventListener('click', () => {
            openNicknameModal();
        });
    }
}

function escapeHTML(str) {
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
}

function openNicknameModal() {
    const modal = document.getElementById('nicknameModal');
    const input = document.getElementById('nicknameInput');
    input.value = getPlayerName();
    modal.classList.add('active');
    setTimeout(() => input.focus(), 100);
}

function closeNicknameModal() {
    document.getElementById('nicknameModal').classList.remove('active');
}

async function submitNickname() {
    const input = document.getElementById('nicknameInput');
    const name = input.value.trim();
    if (!name || name.length < 1 || name.length > 12) {
        showToast('1ã€œ12æ–‡å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
    }
    setPlayerName(name);
    closeNicknameModal();
    showToast('ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’è¨­å®šã—ã¾ã—ãŸï¼');
    
    // ç¾åœ¨ã®çµ±è¨ˆã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡
    await syncRankingToServer();
    renderNicknameSection();
    loadRanking(currentRankingTab);
}

async function syncRankingToServer() {
    const name = getPlayerName();
    if (!name) return;
    
    const playerId = getPlayerId();
    const stats = loadStats();
    const winRate = stats.played > 0 ? Math.round((stats.won / stats.played) * 100) : 0;
    
    const data = {
        player_name: name,
        player_id: playerId,
        current_streak: stats.streak,
        best_streak: stats.bestStreak,
        played: stats.played,
        won: stats.won,
        win_rate: winRate,
        updated_at: firebase.firestore.FieldValue.serverTimestamp()
    };
    
    try {
        // player_idã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆIDã¨ã—ã¦ä½¿ç”¨ï¼ˆupsertï¼‰
        await db.collection('rankings').doc(playerId).set(data, { merge: true });
    } catch (err) {
        console.error('Ranking sync error:', err);
    }
}

async function loadRanking(tab) {
    currentRankingTab = tab;
    const listEl = document.getElementById('rankingList');
    const myBarEl = document.getElementById('myRankingBar');
    listEl.innerHTML = '<div class="ranking-loading"><i class="fas fa-spinner"></i><br>èª­ã¿è¾¼ã¿ä¸­...</div>';
    myBarEl.innerHTML = '';
    
    // Update tab styles
    document.querySelectorAll('.ranking-tab').forEach(t => t.classList.remove('active'));
    document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
    
    try {
        // Firestoreã‹ã‚‰ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        const sortField = getSortField(tab);
        const snapshot = await db.collection('rankings')
            .orderBy(sortField, 'desc')
            .limit(100)
            .get();
        
        let items = [];
        snapshot.forEach(doc => {
            items.push({ id: doc.id, ...doc.data() });
        });
        
        // åŒç‡ã®å ´åˆã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã‚½ãƒ¼ãƒˆ
        items.sort((a, b) => {
            const field = getSortField(tab);
            if (field === 'win_rate') {
                if (b.win_rate !== a.win_rate) return b.win_rate - a.win_rate;
                return b.played - a.played;
            }
            return (b[field] || 0) - (a[field] || 0);
        });
        
        // Limit to top 20
        const top = items.slice(0, 20);
        
        if (top.length === 0) {
            listEl.innerHTML = '<div class="ranking-empty"><i class="fas fa-trophy"></i>ã¾ã ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚<br>ã‚²ãƒ¼ãƒ ã‚’ãƒ—ãƒ¬ã‚¤ã—ã¦ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«å‚åŠ ã—ã‚ˆã†ï¼</div>';
            return;
        }
        
        const playerId = getPlayerId();
        
        // My ranking bar
        const myIdx = items.findIndex(r => r.player_id === playerId);
        if (myIdx >= 0) {
            const my = items[myIdx];
            const rank = myIdx + 1;
            myBarEl.innerHTML = `
                <div class="my-ranking-bar">
                    <div class="ranking-rank">${getRankDisplay(rank)}</div>
                    <div class="ranking-name"><i class="fas fa-user"></i> ${escapeHTML(my.player_name)}ï¼ˆã‚ãªãŸï¼‰</div>
                    <div class="ranking-score">
                        <div class="score-main">${getScoreValue(my, tab)}</div>
                        <div class="score-label">${getScoreLabel(tab)}</div>
                    </div>
                </div>
            `;
        }
        
        // Render list
        let html = '';
        top.forEach((item, idx) => {
            const rank = idx + 1;
            const isMe = item.player_id === playerId;
            let cls = 'ranking-item';
            if (isMe) cls += ' me';
            if (rank === 1) cls += ' top1';
            else if (rank === 2) cls += ' top2';
            else if (rank === 3) cls += ' top3';
            
            html += `
                <div class="${cls}">
                    <div class="ranking-rank ${rank === 1 ? 'gold' : rank === 2 ? 'silver' : rank === 3 ? 'bronze' : ''}">${getRankDisplay(rank)}</div>
                    <div class="ranking-name">${escapeHTML(item.player_name)}${isMe ? ' ğŸ‘ˆ' : ''}</div>
                    <div class="ranking-score">
                        <div class="score-main">${getScoreValue(item, tab)}</div>
                        <div class="score-label">${getScoreLabel(tab)}</div>
                    </div>
                    <div class="ranking-detail">${getRankingDetail(item, tab)}</div>
                </div>
            `;
        });
        
        listEl.innerHTML = html;
        
    } catch (err) {
        console.error('Load ranking error:', err);
        listEl.innerHTML = '<div class="ranking-empty"><i class="fas fa-exclamation-triangle"></i>ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</div>';
    }
}

function getSortField(tab) {
    switch (tab) {
        case 'streak': return 'current_streak';
        case 'best': return 'best_streak';
        case 'winrate': return 'win_rate';
        default: return 'current_streak';
    }
}

function getScoreValue(item, tab) {
    switch (tab) {
        case 'streak': return item.current_streak || 0;
        case 'best': return item.best_streak || 0;
        case 'winrate': return (item.win_rate || 0) + '%';
        default: return item.current_streak || 0;
    }
}

function getScoreLabel(tab) {
    switch (tab) {
        case 'streak': return 'é€£å‹ä¸­';
        case 'best': return 'æœ€å¤§é€£å‹';
        case 'winrate': return 'å‹ç‡';
        default: return 'é€£å‹ä¸­';
    }
}

function getRankingDetail(item, tab) {
    switch (tab) {
        case 'streak': return `æœ€å¤§ ${item.best_streak || 0} / ${item.played || 0}å›`;
        case 'best': return `ç¾åœ¨ ${item.current_streak || 0} / ${item.played || 0}å›`;
        case 'winrate': return `${item.won || 0}å‹ / ${item.played || 0}å›`;
        default: return '';
    }
}

function getRankDisplay(rank) {
    if (rank === 1) return 'ğŸ¥‡';
    if (rank === 2) return 'ğŸ¥ˆ';
    if (rank === 3) return 'ğŸ¥‰';
    return rank;
}

function showRanking() {
    renderNicknameSection();
    loadRanking(currentRankingTab);
    document.getElementById('rankingModal').classList.add('active');
}

// ==============================
// KEYBOARD HANDLER
// ==============================
document.addEventListener('keydown', (e) => {
    if (document.querySelector('.modal-overlay.active')) {
        if (e.key === 'Escape') {
            document.querySelectorAll('.modal-overlay.active').forEach(m => m.classList.remove('active'));
        }
        return;
    }
    
    if (e.key === 'Enter') {
        handleKey('ENTER');
    } else if (e.key === 'Backspace') {
        handleKey('âŒ«');
    } else if (/^[a-zA-Z]$/.test(e.key)) {
        handleKey(e.key.toUpperCase());
    }
});

// ==============================
// EVENT LISTENERS
// ==============================
document.getElementById('helpBtn').addEventListener('click', showHelp);
document.getElementById('statsBtn').addEventListener('click', showStats);
document.getElementById('rankingBtn').addEventListener('click', showRanking);
document.getElementById('helpClose').addEventListener('click', () => {
    document.getElementById('helpModal').classList.remove('active');
});
document.getElementById('statsClose').addEventListener('click', () => {
    document.getElementById('statsModal').classList.remove('active');
});
document.getElementById('rankingClose').addEventListener('click', () => {
    document.getElementById('rankingModal').classList.remove('active');
});
document.getElementById('nicknameClose').addEventListener('click', closeNicknameModal);
document.getElementById('nicknameSubmit').addEventListener('click', submitNickname);
document.getElementById('nicknameInput').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') submitNickname();
});

// Ranking tab clicks
document.getElementById('tabStreak').addEventListener('click', () => loadRanking('streak'));
document.getElementById('tabBest').addEventListener('click', () => loadRanking('best'));
document.getElementById('tabWinrate').addEventListener('click', () => loadRanking('winrate'));
document.getElementById('resultClose').addEventListener('click', closeResult);
document.getElementById('shareBtn').addEventListener('click', shareResult);
document.getElementById('shareClose').addEventListener('click', closeShareModal);
document.getElementById('twitterShareBtn').addEventListener('click', shareOnTwitter);
document.getElementById('copyShareBtn').addEventListener('click', copyResultToClipboard);
document.getElementById('newGameBtn').addEventListener('click', () => {
    closeResult();
    initGame();
});

// Close modals on overlay click
['resultModal', 'helpModal', 'statsModal', 'rankingModal', 'nicknameModal'].forEach(id => {
    document.getElementById(id).addEventListener('click', (e) => {
        if (e.target === e.currentTarget) {
            e.currentTarget.classList.remove('active');
        }
    });
});

// ==============================
// INIT
// ==============================
createSakura();
initGame();

// Show help on first visit
if (!localStorage.getItem('chimeidle-visited')) {
    localStorage.setItem('chimeidle-visited', 'true');
    setTimeout(showHelp, 500);
}

// Game number
const today = new Date();
const start = new Date(2026, 0, 1);
const dayNum = Math.floor((today - start) / 86400000) + 1;
document.getElementById('game-number').innerHTML = `<i class="fas fa-gamepad"></i> #${dayNum}`;
</script>

</body>
</html>
